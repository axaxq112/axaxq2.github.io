<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="description" content="AirPortal（空投）是一个可以跨设备传输文件的网站。只要您的设备联网，您就可以通过它在任意系统、任意设备间传输文件。无需登录或注册，只需打开 AirPortal、直接上传文件、记住所给的取件码或直接扫描二维码即可在另一台设备上下载文件。" />
  <meta name="renderer" content="webkit" />
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>AirPortal | 空投</title>
  <link href="static/css/index.css" rel="stylesheet" type="text/css" />
  <script src="static/js/jquery.min.js"></script>
  <script src="static/js/layer.min.js"></script>
</head>
<body class="">
  <picture class="logo-box">
    <img src="static/img/logo.png" />
  </picture>
  <input type="file" id="upload-file" name="upload-file" style="display: none;" />
  <div id="main-box" class="main-box">
    <button id="send" class="main-btn" onclick="choose()">选择</button>
    <!-- <button id="receive" class="main-btn" onclick="ajax()" style="display: none;">发送</button>  -->
    <button id="receive" class="main-btn" onclick="receive()">接收</button>
  </div>
  <div>
    <script>
      $("input[name='upload-file']").on("change", function() {
        var filePath = $(this).val();
        if (filePath) {
          //$(".fileerrorTip").html("").hide();
          var arr = filePath.split('\\');
          var fileName = arr[arr.length - 1];
          layer.msg(fileName);
          var size1 = $("input[name='upload-file']")[0].files[0].size;
        if (size1>2147483648) {
        	layer.alert("上传文件不能大于2GB!");
        	return false;
        }
        //判断文件类型
        // var fileName1 = $file1.substring($file1.lastIndexOf(".") + 1).toLowerCase();
        // if(fileName1 != "xls" && fileName1 !="xlsx"){
        //   	alert("请选择允许的文件（xls、xlsx）");				
        // 	return false;
        // }
          ajax(); //调用上传文件
        } else {
          //$(".showFileName").html("");
          layer.alert("请选择一个文件");
          return false;
        }
      });


      function choose() {
        var file = document.getElementById("upload-file");
        file.click();
      }

      function ajax() {
        boo1 = true;
        var type = "file";
        var formData = new FormData();
        formData.append(type, $("#upload-file")[0].files[0]);

        var wait = layer.msg('上传中(若过久请刷新重试)..', {
          icon: 16,
          shade: 0.3,
          time: false
        });
        $.ajax({
          type: "post",
          url: "exec.php?mod=upload",
          data: formData,
          processData: false,
          contentType: false,
          success: function(data) {
            layer.close(wait);
            if (data.code == "200") {
              layer.alert("提取码：" + data.src);
            } else if (data.code == "500") {
              layer.alert("上传失败：" + data.src);
            }
          }
        });
      }

      function receive() {
        var wait = layer.msg('查询中..', {
          icon: 16,
          shade: 0.3,
          time: false
        });
        var index = layer.prompt({
          title: '请输入提取码(小写即可)',
          btn2: function(){
            //取消回调
            layer.close(wait);
          }
        }, function(val, index) {
          layer.msg(val);
          layer.close(index);
          $.ajax({
            type: "post",
            url: "exec.php?mod=check",
            data: "code=" + val,
            success: function(data) {
              layer.close(wait);
              if (data.code == "200") {
                layer.open({
                  type: 1,
                  area: ['500px', '300px'],
                  skin: 'layui-layer-demo', //样式类名
                  closeBtn: 0, //不显示关闭按钮
                  anim: 2,
                  title: '查询成功',
                  shadeClose: true, //开启遮罩关闭
                  content: data.src
                });
              } else if (data.code == "500") {
                layer.alert("查询失败：" + data.src);
              }
            }
          });
        });
      }
    </script>
  </div>
</body>
</html>
